# Пояснительная записка — Realtime Quiz App (MVP)

## 1. Описание проекта

**Realtime Quiz App** — веб-приложение для проведения интерактивных викторин в реальном времени. Платформа позволяет организаторам создавать квизы с текстовыми и графическими вопросами, запускать live-сессии и управлять ходом игры. Участники подключаются по уникальному 6-символьному коду комнаты, отвечают на вопросы в режиме реального времени и видят обновляемый лидерборд.

### Ключевые функции

- **Регистрация и авторизация** с разделением на роли: Организатор / Участник
- **CRUD квизов** — создание, редактирование и удаление квизов с настраиваемыми параметрами вопросов (таймер, баллы, одиночный/множественный выбор)
- **Live-сессии** — синхронизированная работа в реальном времени через WebSocket (Socket.IO): показ вопросов, таймеры, отправка ответов, раскрытие правильных ответов
- **Система подсчёта баллов** — мгновенное начисление очков и обновление лидерборда после каждого вопроса
- **История результатов** — просмотр итогов прошедших сессий

---

## 2. Обоснование выбора средств разработки

### 2.1. Next.js 14 (App Router) — фреймворк

| Критерий | Обоснование |
|---|---|
| **Fullstack-подход** | API Routes позволяют реализовать REST API без отдельного бэкенд-сервера, сокращая количество сервисов в продакшене |
| **Server Components** | Серверный рендеринг компонентов снижает размер JavaScript-бандла на клиенте и ускоряет первую загрузку |
| **App Router** | Файловая маршрутизация с вложенными layout, loading и error-состояниями упрощает организацию кода |
| **Деплой** | Нативная поддержка Vercel обеспечивает zero-config деплой с автоматическим CI/CD |

**Альтернативы и причины отказа:**
- *Vite + Express* — потребовал бы отдельной настройки SSR и два независимых сервера
- *Remix* — менее зрелая экосистема и меньшее сообщество на момент выбора

### 2.2. TypeScript — язык разработки

Строгая типизация применяется на всех уровнях приложения: frontend, API, Socket.IO-сервер и схемы валидации. Это обеспечивает:
- Раннее обнаружение ошибок на этапе компиляции
- Автодокументирование интерфейсов между слоями
- Надёжный рефакторинг при развитии проекта

### 2.3. PostgreSQL + Prisma ORM — база данных

| Компонент | Обоснование |
|---|---|
| **PostgreSQL 16** | Реляционная СУБД с поддержкой ACID, оптимальная для связанных данных (квизы → вопросы → варианты ответов → ответы пользователей) |
| **Prisma** | Декларативная схема (`schema.prisma`) служит единым источником истины для структуры БД, генерирует типизированный клиент и управляет миграциями |
| **Docker Compose** | Контейнеризация PostgreSQL обеспечивает воспроизводимую среду разработки без ручной установки СУБД |

**Альтернативы и причины отказа:**
- *MongoDB* — квиз-данные имеют чёткую реляционную структуру (один-ко-многим, многие-ко-многим), документная модель потребовала бы денормализацию и усложнила запросы
- *SQLite* — не поддерживает конкурентную запись, критичную для real-time сессий с множеством участников

### 2.4. Socket.IO — real-time коммуникация

WebSocket-транспорт через Socket.IO выбран для синхронизации состояния live-сессий:
- Автоматический fallback на long-polling при невозможности установить WebSocket-соединение
- Встроенная поддержка комнат (rooms) — каждая сессия = отдельная комната
- Middleware для аутентификации по зашифрованному cookie
- Надёжная обработка переподключений и disconnect-событий

### 2.5. Tailwind CSS — стилизация

Utility-first подход позволяет быстро прототипировать UI без переключения контекста между файлами стилей и компонентами. Кастомная палитра `primary` обеспечивает единообразие дизайна.

### 2.6. Zod — валидация данных

Схемы Zod используются на серверной стороне для валидации входных данных API. Интеграция с TypeScript обеспечивает автоматическое выведение типов из схем валидации.

### 2.7. Вспомогательные инструменты

| Инструмент | Назначение |
|---|---|
| **bcryptjs** | Хеширование паролей (10 раундов) |
| **cookie** | Управление HTTP-only сессионными cookie с AES-256-CBC шифрованием |
| **concurrently** | Параллельный запуск Next.js и Socket.IO-сервера в dev-режиме |
| **tsx** | Исполнение TypeScript-файлов (сервер Socket.IO, seed-скрипт) |

---

## 3. Архитектура приложения

```
┌──────────────────────────────────────────────────────┐
│                     Клиент (браузер)                 │
│  React Components ←→ Custom Hooks (useSocket)        │
└──────────┬──────────────────────────┬────────────────┘
           │ HTTP (REST API)          │ WebSocket
           ▼                          ▼
┌─────────────────────┐    ┌─────────────────────┐
│   Next.js Server    │    │  Socket.IO Server   │
│   (порт 3000)       │    │  (порт 3001)        │
│                     │    │                     │
│  API Routes         │    │  Event Handlers     │
│  Server Components  │    │  Session Manager    │
│  Auth Middleware     │    │  Auth Middleware     │
└─────────┬───────────┘    └─────────┬───────────┘
          │                          │
          ▼                          ▼
┌──────────────────────────────────────────────────────┐
│           Service Layer (features/)                  │
│     QuizService / SessionService / ScoringService    │
└──────────────────────┬───────────────────────────────┘
                       ▼
┌──────────────────────────────────────────────────────┐
│              PostgreSQL 16 (Prisma ORM)              │
│   User │ Quiz │ Question │ Option │ Session │ Score  │
└──────────────────────────────────────────────────────┘
```

### Модель данных (основные сущности)

- **User** — пользователь с ролью (ORGANIZER / PARTICIPANT)
- **Quiz** — квиз, принадлежащий организатору
- **Question** — вопрос с типом (TEXT / IMAGE), таймером и баллами
- **Option** — вариант ответа (с флагом `isCorrect`)
- **Session** — live-сессия с уникальным `roomCode` и состоянием (LOBBY → QUESTION → REVEAL → FINISHED)
- **Answer** — ответ участника с автоматическим расчётом корректности
- **Score** — агрегированные баллы участника в рамках сессии

---

## 4. Основные этапы разработки

### Этап 1. Проектирование и настройка инфраструктуры
- Проектирование модели данных и ER-диаграммы
- Инициализация Next.js-проекта с TypeScript и Tailwind CSS
- Настройка PostgreSQL через Docker Compose
- Конфигурация Prisma ORM, создание схемы и миграций
- Настройка линтинга, path aliases, переменных окружения

### Этап 2. Аутентификация и авторизация
- Реализация регистрации и входа по email/password
- Хеширование паролей через bcryptjs
- Сессионное управление через зашифрованные HTTP-only cookie (AES-256-CBC)
- Ролевая модель доступа (Организатор / Участник)
- Защита API-маршрутов и server-компонентов

### Этап 3. CRUD квизов и вопросов
- REST API для создания, редактирования, удаления квизов
- Управление вопросами: текстовые/графические, одиночный/множественный выбор
- Настраиваемые параметры: таймер (5–300 сек), баллы (1–1000)
- Валидация входных данных через Zod-схемы
- UI: dashboard организатора, форма создания/редактирования квиза

### Этап 4. Real-time сессии (Socket.IO)
- Выделенный Socket.IO-сервер с аутентификацией через cookie middleware
- Session Manager для управления состоянием активных сессий в памяти
- Генерация уникальных 6-символьных кодов комнат
- Жизненный цикл сессии: лобби → вопрос → раскрытие → завершение
- Синхронизация таймеров, отправка/приём ответов
- Автоматический расчёт баллов и обновление лидерборда

### Этап 5. Интерфейс участника и игровой процесс
- Страница ввода кода комнаты (/join)
- Игровой экран (/play) с отображением вопросов, вариантов ответов и таймера
- Визуальная обратная связь: подтверждение ответа, раскрытие правильных ответов
- Экран результатов с итоговым лидербордом

### Этап 6. Тестирование и деплой
- Seed-скрипт для наполнения БД тестовыми данными
- Ручное end-to-end тестирование полного цикла: создание квиза → запуск сессии → участие → завершение
- Подготовка к деплою: Next.js → Vercel, Socket.IO-сервер → Railway/Render, PostgreSQL → облачный провайдер

---

## 5. Стек технологий (сводка)

| Слой | Технология | Версия |
|---|---|---|
| Frontend | React | 18.2.0 |
| Framework | Next.js (App Router) | 14.1.0 |
| Язык | TypeScript | 5.3.3 |
| Стилизация | Tailwind CSS | 3.4.1 |
| Real-time | Socket.IO | 4.7.4 |
| ORM | Prisma | 6.19.2 |
| СУБД | PostgreSQL | 16 |
| Валидация | Zod | 3.22.4 |
| Контейнеризация | Docker Compose | — |

---

## Приложения

- **Репозиторий:** [github.com/6Methods/QuizzAppMvp](https://github.com/6Methods/QuizzAppMvp)
- **Макеты:** *(добавить ссылку на Figma / Excalidraw)*
- **Работоспособный продукт:** *(добавить ссылку после деплоя, опционально)*
